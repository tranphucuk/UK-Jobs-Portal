var role={init:function(){this.loadData();role.loadFunction();this.registerEvents()},registerEvents:function(){var n=$("#frm-role").validate({errorClass:"red",rules:{txtNameRole:"required",txtRoleDescription:"required"}});$("#btn-create-role").off("click").on("click",function(){$("#add-edit-role").modal("show");role.clearForm();n.resetForm()});$("body").on("click",".btn-edit-role",function(){var n=$(this).attr("data-id");$("#hid-role-id").val(n);$.ajax({type:"GET",url:"/Admin/Role/GetRoleDetail",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){n.Status&&($("#add-edit-role").modal("show"),$("#txt-role-name").val(n.Data.Name),$("#txt-role-description").val(n.Data.Description),$("#ck-role-status").prop("checked",n.Data.Status));common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred.","error");common.stopLoadingIndicator()}})});$("body").on("click",".btn-delete-role",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to remove this role?",function(){$.ajax({type:"POST",url:"/Admin/Role/DeleteRole",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){n.Status&&common.notify("Removed success role: "+n.Message,"success");role.loadData();common.stopLoadingIndicator()},error:function(){common.notify("Remove role failed.","error");common.stopLoadingIndicator()}})})});$("body").on("click",".btn-grant-permission",function(){$("#hid-role-id").val($(this).attr("data-id"));$("#grant-permission-modal").modal("show");role.clearPermission();role.fillPermission($(this).attr("data-id"))});$("#btn-save-role").on("click",function(){var i=$("#hid-role-id").val(),t;n.form()&&(t={},i!=""&&(t.Id=i),t.Name=$("#txt-role-name").val(),t.Description=$("#txt-role-description").val(),t.Status=$("#ck-role-status").is(":checked")?1:0,$.ajax({type:"POST",url:"/Admin/Role/SaveRole",data:{appRoleViewModel:t},beforeSend:common.runLoadingIndicator(),success:function(n){common.notify("Save success role: "+n.Data.Message,"success");$("#add-edit-role").modal("hide");common.stopLoadingIndicator();role.loadData()},error:function(){common.notify("An error has occurred","error");common.stopLoadingIndicator()}}))});$("#ck-read-all").off("click").on("click",function(){var n=$("#ck-read-all").is(":checked");n?$("#tbl-permisson-body #ck-read-permission").each(function(n,t){$(t).prop("checked",!0)}):$("#tbl-permisson-body #ck-read-permission").each(function(n,t){$(t).prop("checked",!1)})});$("#ck-create-all").off("click").on("click",function(){var n=$("#ck-create-all").is(":checked");n?$("#tbl-permisson-body #ck-create-permission").each(function(n,t){$(t).prop("checked",!0)}):$("#tbl-permisson-body #ck-create-permission").each(function(n,t){$(t).prop("checked",!1)})});$("#ck-update-all").off("click").on("click",function(){var n=$("#ck-update-all").is(":checked");n?$("#tbl-permisson-body #ck-update-permission").each(function(n,t){$(t).prop("checked",!0)}):$("#tbl-permisson-body #ck-update-permission").each(function(n,t){$(t).prop("checked",!1)})});$("#ck-delete-all").off("click").on("click",function(){var n=$("#ck-delete-all").is(":checked");n?$("#tbl-permisson-body #ck-delete-permission").each(function(n,t){$(t).prop("checked",!0)}):$("#tbl-permisson-body #ck-delete-permission").each(function(n,t){$(t).prop("checked",!1)})});$("body").on("click","#ck-read-permission",function(){role.isReadAll()});$("body").on("click","#ck-create-permission",function(){role.isCreateAll()});$("body").on("click","#ck-update-permission",function(){role.isEditAll()});$("body").on("click","#ck-delete-permission",function(){role.isDeleteAll()});$("#btn-save-permission").off("click").on("click",function(){var n=$("#hid-role-id").val(),t=[];$("#tbl-permisson-body tr").each(function(i,r){var u={};u.RoleId=n;u.FunctionId=$(r).attr("data-id");u.CanRead=$(r).find("#ck-read-permission").is(":checked");u.CanCreate=$(r).find("#ck-create-permission").is(":checked");u.CanEdit=$(r).find("#ck-update-permission").is(":checked");u.CanDelete=$(r).find("#ck-delete-permission").is(":checked");t.push(u)});$.ajax({type:"POST",url:"/Admin/Role/SavePermission",data:{permissionViewModels:t,roleId:n},beforeSend:common.runLoadingIndicator(),success:function(){$("#grant-permission-modal").modal("hide");common.notify("Save success","success");common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred","error");common.stopLoadingIndicator()}})})},loadData:function(){$.ajax({type:"GET",url:"/Admin/Role/GetAll",beforeSend:common.runLoadingIndicator(),success:function(n){var t="",i=$("#tbl-role-template").html();$.each(n,function(n,r){var u={};u.Id=r.Id;u.Name=r.Name;u.Description=r.Description;u.Status=common.getStatusLabel(r.Status);t+=Mustache.render(i,u)});$("#tbl-render-role").html(t);common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred","error");common.stopLoadingIndicator()}})},loadFunction:function(){var n="",t=$("#tbl-permission-template").html();$.ajax({type:"GET",url:"/Admin/Role/GetAllFunction",beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i,function(i,r){var u={};u.Id=r.Id;r.ParentId!=null&&(u.ParentId=" treegrid-parent-"+r.ParentId);u.Function="<strong>"+r.Name+"<\/strong>";n+=Mustache.render(t,u)});$("#tbl-permisson-body").html(n);$(".tree").treegrid({initialState:"collapsed"});common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred","error");common.stopLoadingIndicator()}})},fillPermission:function(n){$.ajax({type:"GET",url:"/Admin/Role/LoadPermissionByRoleId",data:{guidId:n},beforeSend:common.runLoadingIndicator(),success:function(n){$.each(n,function(n,t){$("#tbl-permisson-body").find('tr[data-id="'+t.FunctionId+'"] #ck-read-permission').prop("checked",t.CanRead);$("#tbl-permisson-body").find('tr[data-id="'+t.FunctionId+'"] #ck-create-permission').prop("checked",t.CanCreate);$("#tbl-permisson-body").find('tr[data-id="'+t.FunctionId+'"] #ck-update-permission').prop("checked",t.CanEdit);$("#tbl-permisson-body").find('tr[data-id="'+t.FunctionId+'"] #ck-delete-permission').prop("checked",t.CanDelete);role.isReadAll();role.isCreateAll();role.isEditAll();role.isDeleteAll()});common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred","error");common.stopLoadingIndicator()}})},isReadAll:function(){var n=$("#tbl-permisson-body #ck-read-permission").length;totalChecked=$("#tbl-permisson-body #ck-read-permission:checked").length;totalChecked<n?$("#ck-read-all").prop("checked",!1):$("#ck-read-all").prop("checked",!0)},isCreateAll:function(){var n=$("#tbl-permisson-body #ck-create-permission").length;totalChecked=$("#tbl-permisson-body #ck-create-permission:checked").length;totalChecked<n?$("#ck-create-all").prop("checked",!1):$("#ck-create-all").prop("checked",!0)},isEditAll:function(){var n=$("#tbl-permisson-body #ck-update-permission").length;totalChecked=$("#tbl-permisson-body #ck-update-permission:checked").length;totalChecked<n?$("#ck-update-all").prop("checked",!1):$("#ck-update-all").prop("checked",!0)},isDeleteAll:function(){var n=$("#tbl-permisson-body #ck-delete-permission").length;totalChecked=$("#tbl-permisson-body #ck-delete-permission:checked").length;totalChecked<n?$("#ck-delete-all").prop("checked",!1):$("#ck-delete-all").prop("checked",!0)},clearPermission:function(){$('.tbl-permission input[type="checkbox"]').prop("checked",!1)},clearForm:function(){$("#txt-role-name").val("");$("#txt-role-description").val("")}};role.init();