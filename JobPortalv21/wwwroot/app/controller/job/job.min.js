var job={init:function(){job.loadData();this.loadTier("#ddl-tier-info");job.loadTags();job.registerEvents();this.loadCkEditor()},registerEvents:function(){var n=$("#frm-job").validate({errorClass:"red",rules:{txtJobIndustry:"required",txtJobCompany:"required",txtJobWebsite:"required",txtJobCity:"required",ddlJoxTier:{required:!0,number:!0},txtJobTags:{required:!0},txtJobDescription:"required"}});$("#ddl-display-number").on("change",function(){config.pageSize=$("#ddl-display-number :selected").text();config.pageIndex=1;$("#pagination-job").twbsPagination("destroy");job.loadData()});$("#txt-keyword-job").on("keypress",function(n){n.which===13&&$("#btn-search-job").click()});$("#btn-search-job").on("click",function(){$("#pagination-job").twbsPagination("destroy");$("#ddl-display-number").prop("selectedIndex",0);config.pageIndex=1;config.pageSize=10;job.loadData()});$("#btn-excel-modal").on("click",function(){$("#btn-excel-options").modal("show")});$("body").on("click","#btn-import-excel",function(){$("#file-import-excel").click()});$("#file-import-excel").on("change",function(){var t=this.files[0],n=new FormData;n.append("files",t);$("#btn-excel-options").modal("hide");$.ajax({type:"POST",url:"/Admin/Job/ImportJob",data:n,processData:!1,contentType:!1,beforeSend:common.runLoadingIndicator,success:function(){common.notify("Import succeeded","success");job.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("Err: "+n,"error");console.log(n);common.stopLoadingIndicator()}})});$("#btn-create-job").off("click").on("click",function(){$("#add-edit-job").modal("show");n.resetForm();job.clearForm();job.loadTier("#ddl-bind-tier");job.dropdownConfig()});$("#btn-save-job").off("click").on("click",function(){var i=$("#hid-job-id").val(),t;n.form()&&(t={},i!==""&&(t.Id=i,t.CreatedDate=$("#txt-job-created-at").val()),t.Industry=$("#txt-job-name").val(),t.Company=$("#txt-job-company").val(),t.Website=$("#txt-job-website").val(),t.Description=CKEDITOR.instances.txtJobContent.getData(),t.City=$("#txt-job-city").val(),t.Tier=$("#ddl-bind-tier :selected").val(),t.Tags=$(".select-job-tag").val().join(),t.Status=$("#ck-job-status").is(":checked")?1:0,$.ajax({type:"POST",url:"/Admin/Job/SaveJob",data:{jobViewModel:t},beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Save job success","success");$("#add-edit-job").modal("hide");job.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("An error has occurred while saving.","error");console.log(n);common.stopLoadingIndicator()}}))});$("body").on("click",".btn-edit-job",function(){job.clearForm();n.resetForm();var t=$(this).attr("data-id");$("#hid-job-id").val(t);$.ajax({type:"GET",url:"/Admin/Job/GetJobDetail",data:{id:t},beforeSend:common.runLoadingIndicator(),success:function(n){$("#add-edit-job").modal("show");job.loadTier("#ddl-bind-tier");$("#txt-job-name").val(n.Industry);$("#txt-job-company").val(n.Company);$("#txt-job-website").val(n.Website);CKEDITOR.instances.txtJobContent.setData(n.Description);$("#txt-job-city").val(n.City);$("#ddl-bind-tier").val(n.Tier);var t=n.Tags.split(",");$(".select-job-tag").val(t);job.dropdownConfig();$("#ck-job-status").prop("checked",n.Status);$("#txt-job-created-at").val(common.formatDateTime(n.CreatedDate));$("#txt-job-modified-at").val(common.formatDateTime(n.ModifiedDate));common.stopLoadingIndicator()},error:function(n){common.notify("Error loading job","error");console.log(n);common.stopLoadingIndicator()}})});$("body").on("click",".btn-delete-job",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to remove this job?",function(){$.ajax({type:"POST",url:"/Admin/Job/DeleteJob",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(){common.notify("delete success","success");$("#txt-keyword-job").val("");$("#ddl-tier-info").val("");$("#pagination-job").twbsPagination("destroy");job.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("An error has occurred while deleting","error");console.log(n);common.stopLoadingIndicator()}})})})},loadCkEditor:function(){CKEDITOR.replace("txtJobContent",{language:"en"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}},loadTags:function(){$.ajax({type:"GET",url:"/Admin/Job/GetTags",success:function(n){$.each(n,function(n,t){$(".select-job-tag").append('<option value="'+t+'">'+t+"<\/option>")})}})},dropdownConfig:function(){$(".select-job-tag").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"});$(".select-job-tag").trigger("chosen:updated")},loadTier:function(n){$(n).append('<option disabled="disabled" value="" selected="selected">Tier<\/option>');$.ajax({type:"GET",url:"/Admin/Job/ParseEnum",dataType:"json",success:function(t){$.each(t,function(t,i){$(n).append('<option value="'+i.Value+'" >'+i.Text+"<\/option>")})}})},loadData:function(){var n="",t=$("#tbl-job-template").html();$.ajax({type:"GET",url:"/Admin/Job/GetAllPaging",dataType:"json",data:{tier:$("#ddl-tier-info").val(),keyword:$("#txt-keyword-job").val(),pageSize:config.pageSize,page:config.pageIndex},beforeSend:common.runLoadingIndicator(),success:function(i){if(i.Total==0){common.notify("No Job Matched","error");common.stopLoadingIndicator();return}$.each(i.Result,function(i,r){var u={};u.Id=r.Id;u.Job=r.Industry;u.Company=r.Company;u.Website=r.Website;u.Tier=common.defineTier(r.Tier);u.City=r.City;u.Status=common.getStatusLabel(r.Status);n+=Mustache.render(t,u)});n!=""&&$("#tbl-render-job").html(n);i.Total>0&&job.paging(i.Total);$("#total-job").html(i.Total);common.stopLoadingIndicator()},error:function(n){common.notify("An error has occurred while loading data","error");console.log(n);common.stopLoadingIndicator()}})},clearForm:function(){$("#txt-job-name").val("");$("#txt-job-company").val("");$("#txt-job-website").val("");$("#txt-job-city").val("");CKEDITOR.instances.txtJobContent.setData("");$("#ddl-bind-tier").html("");$(".select-job-tag").val("");$("#frm-job-created").hide();$("#frm-job-modified").hide()},paging:function(n){var t=Math.ceil(n/config.pageSize);$("#pagination-job").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=config.pageIndex&&(config.pageIndex=t,job.loadData())}})}};job.init();