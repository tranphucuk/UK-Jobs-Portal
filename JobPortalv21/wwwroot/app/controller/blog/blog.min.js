var blog={init:function(){this.loadData();this.registerEvents();this.loadCkEditor()},registerEvents:function(){var n=$("#frm-blog").validate({errorClass:"red",rules:{txtBlogName:"required",txtBlogThumbnail:"required",txtBlogDescription:{required:!0,minlength:1,maxlength:500},txtBlogContent:{required:!0,minlength:1}},messages:{txtBlogName:{required:"Name is required"},txtBlogThumbnail:{required:"Thumbnail is required"},txtBlogDescription:{required:"Description is required"},txtBlogContent:{required:"Content is required"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("#ddlShowPage").on("change",function(){config.pageSize=$("#ddlShowPage :selected").text();config.pageIndex=1;$("#pagination-blog").twbsPagination("destroy");blog.loadData()});$("#txt-blog-keyword").on("keypress",function(n){n.which===13&&$("#btn-search-blog").click()});$("#btn-search-blog").off("click").on("click",function(){$("#pagination-blog").twbsPagination("destroy");$("#ddlShowPage").prop("selectedIndex",0);config.pageIndex=1;config.pageSize=10;blog.loadData()});$("#ddl-blog-options").off("change").on("change",function(){config.pageSize=$("#ddlShowPage :selected").text();config.pageIndex=1;$("#pagination-blog").twbsPagination("destroy");blog.loadData()});$("#btn-create-blog").on("click",function(){$("#add-edit-blog").modal("show")});$("body").on("click",".btnUpdateBlog",function(){var n=$(this).data("id");$("#hid-blog-id").val(n);$.ajax({type:"GET",url:"/Admin/Blog/GetBlogDetails",data:{blogId:n},beforeSend:common.runLoadingIndicator(),success:function(n){$("#add-edit-blog").modal("show");$("#txt-blog-name").val(n.Name);$("#txt-blog-thumbnail").val(n.Image);$("#txt-blog-description").val(n.Description);CKEDITOR.instances["txt-blog-content"].setData(n.Content);$("#ck-blog-status").prop("checked",n.Status);$("#ck-blog-hot").prop("checked",n.HotFlag);$("#hid-blog-date").val(n.CreatedDate);common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})});$("#btn-select-thumbnail").off("click").on("click",function(){$("#file-blog-thumbnail").val("");$("#file-blog-thumbnail").click()});$("#file-blog-thumbnail").on("change",function(){blog.thumbnail=$(this)[0].files[0];$("#txt-blog-thumbnail").val("/client-side/images/blog/"+blog.thumbnail.name)});$("#btn-save-blog").off("click").on("click",function(){var i=$("#hid-blog-id").val(),t;n.form()&&(t=new FormData,i!=""&&i!=undefined&&(t.append("Id",i),t.append("CreatedDate",$("#hid-blog-date").val())),t.append("image",blog.thumbnail),t.append("Name",$("#txt-blog-name").val()),t.append("Description",$("#txt-blog-description").val()),t.append("Image",$("#txt-blog-thumbnail").val()),t.append("Content",CKEDITOR.instances["txt-blog-content"].getData()),t.append("Status",$("#ck-blog-status").is(":checked")?1:0),t.append("HotFlag",$("#ck-blog-hot").is(":checked")?1:0),$.ajax({type:"POST",url:"/Admin/Blog/SaveBlog",data:t,processData:!1,contentType:!1,beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Save blog success.","success");$("#add-edit-blog").modal("hide");blog.loadData();blog.clearForm();common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}}))});$("body").on("click",".btnDeleteBlog",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Blog/RemoveBlog",data:{blogId:n},beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Remove success!","success");blog.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})})})},thumbnail:[],loadData:function(){var n="",t=$("#tbl-blog-template").html(),i=$("#txt-blog-keyword").val(),r=$("#ddl-blog-options").val();$.ajax({type:"GET",url:"/Admin/Blog/GetAllPaging",data:{sortType:r,keyword:i,pageSize:config.pageSize,page:config.pageIndex},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Result,function(i,r){var u={};u.Id=r.Id;u.Name=r.Name;u.Image=common.formatImageWithSize(r.Image,100);u.CreatedDate=common.formatDateTime(r.CreatedDate);u.ViewCount=r.ViewCount;u.Status=common.getStatusLabel(r.Status);n+=Mustache.render(t,u)});$("#tbl-blog-content").html(n);i.Total>0&&blog.paging(i.Total);$("#lbl-total-blog").html(i.Total);common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred while loading data","error");common.stopLoadingIndicator()}})},paging:function(n){var t=Math.ceil(n/config.pageSize);$("#pagination-blog").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=config.pageIndex&&(config.pageIndex=t,blog.loadData())}})},clearForm:function(){$("#txt-blog-name").val("");$("#txt-blog-thumbnail").val("");$("#txt-blog-description").val("");CKEDITOR.instances["txt-blog-content"].setData("");$("#ck-blog-status").prop("checked",!0);$("#ck-blog-show-home").prop("checked",!1);$("#ck-blog-hot").prop("checked",!1)},loadCkEditor:function(){CKEDITOR.replace("txtBlogContent",{language:"en",height:"380px"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}};blog.init();