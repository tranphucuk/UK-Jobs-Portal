var user={init:function(){this.loadData();this.registerEvents()},registerEvents:function(){var n=$("#frm-user").validate({errorClass:"red",rules:{txtUsername:"required",txtUserFullname:"required",txtUserPassword:{required:!0,minlength:8,maxlength:30},txtUserEmail:{required:!0,email:!0},txtUserPhoneNumber:{number:!0,minlength:10,maxlength:15},txtUserAvatar:"required",txtUserBirthday:"required",txtUserAddress:"required"},messages:{txtUserPhoneNumber:{required:"Please enter your correct phone number."}}});$("#btn-search-user").off("click").on("click",function(){$("#pagination-user").twbsPagination("destroy");$("#ddl-display-number").prop("selectedIndex",0);config.pageIndex=1;config.pageSize=10;user.loadData()});$("#txt-keyword-user").on("keypress",function(n){n.which===13&&$("#btn-search-user").click()});$("#btn-avatar-img").on("click",function(){$("#btn-avatar-file").val("");$("#btn-avatar-file").click()});$("#btn-avatar-file").on("change",function(){var n=$(this)[0].files[0];$("#txt-user-avatar").val("/admin-side/images/user/"+n.name);user.data=n});$("#btn-create-user").off("click").on("click",function(){$("#add-edit-user").modal("show");user.clearForm();n.resetForm();$("#frm-user-password").show();$("#frm-created-date").hide();$("#frm-modified-date").hide()});$("body").on("click",".btn-edit-user",function(){var n=$(this).attr("data-id");$("#hid-user-id").val(n);user.clearForm();$.ajax({type:"GET",url:"/Admin/User/GetUserDetailAsync",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){$("#add-edit-user").modal("show");var t=n.Data;$("#txt-user-name").val(t.UserName);$("#txt-user-name").attr("disabled","disabled");$("#frm-user-password").hide();$("#txt-user-fullname").val(t.Fullname);$("#txt-user-email").val(t.Email);$("#txt-phone-number").val(t.PhoneNumber);$("#txt-user-avatar").val(t.Avatar);$('input:radio[name="sex"]').val([t.Gender]);$("#txt-user-birthday").datepicker("update",t.Birthday);$("#txt-user-address").val(t.Address);$("#frm-created-date").show();$("#frm-modified-date").show();$("#txt-created-date").val(common.formatDateTime(t.CreatedDate));$("#txt-modified-date").val(common.formatDateTime(t.ModifiedDate));$("#ck-user-status").prop("checked",t.Status);$.each(t.Roles,function(n,t){$("#frm-role-group").find('input[value="'+t+'"]').prop("checked",!0)});common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred.","error");common.stopLoadingIndicator()}})});$("body").on("click",".btn-delete-user",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to delete user?",function(){$.ajax({type:"POST",url:"/Admin/User/DeleteAsync",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){n.Status?common.notify("Removed user: "+n.Message+" success.","success"):common.notify("Erorr: "+n.Message,"error");user.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("An error has occurred: "+n,"error");common.stopLoadingIndicator()}})})});$("#btn-save-user").off("click").on("click",function(){var i=$("#hid-user-id").val(),t;n.form()&&(t=new FormData,i!=""&&i!=undefined&&(t.append("Id",i),t.append("CreatedDate",$("#txt-created-date").val())),t.append("Username",$("#txt-user-name").val()),t.append("Password",$("#txt-user-password").val()),t.append("Fullname",$("#txt-user-fullname").val()),t.append("Phonenumber",$("#txt-phone-number").val()),t.append("Email",$("#txt-user-email").val()),t.append("Avatar",$("#txt-user-avatar").val()),t.append("Birthday",$("#txt-user-birthday").val()),t.append("Address",$("#txt-user-address").val()),t.append("Gender",$("#rad-user-male").is(":checked")?0:1),t.append("Status",$("#ck-user-status").is(":checked")?1:0),$.each($('#frm-role-group input[type="checkbox"]:checked'),function(n,i){t.append("Roles",$(i).val())}),t.append("file",user.data),$.ajax({type:"POST",url:"/Admin/User/SaveUserAsync",data:t,processData:!1,contentType:!1,beforeSend:common.runLoadingIndicator(),success:function(n){n.Status?(common.notify("Save user: "+n.Message+" success","success"),$("#add-edit-user").modal("hide"),user.loadData()):common.notify("Error: "+n.Message,"error");common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred.","error");common.stopLoadingIndicator()}}))})},data:[],loadData:function(){var n="",t=$("#tbl-user-template").html();$.ajax({type:"GET",url:"/Admin/User/GetAllPaging",data:{page:config.pageIndex,pageSize:config.pageSize,keyword:$("#txt-keyword-user").val()},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Result,function(i,r){var u={};u.Id=r.Id;u.Username=r.UserName;u.Email=r.Email;u.Fullname=r.Fullname;u.Avatar=common.formatImage(r.Avatar);u.Phone=r.PhoneNumber;u.CreatedDate=common.formatDateTime(r.CreatedDate);u.Status=common.getStatusLabel(r.Status);n+=Mustache.render(t,u)});$("#tbl-render-user").html(n);user.pagination(i.Total);common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred.","error");common.stopLoadingIndicator()}})},pagination:function(n){var t=Math.ceil(n/config.pageSize);$("#pagination-user").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){config.pageIndex!=t&&user.loadData()}})},clearForm:function(){$("#txt-user-name").val("");$("#txt-user-name").removeAttr("disabled");$("#txt-user-password").val("");$("#txt-user-fullname").val("");$("#txt-user-email").val("");$("#txt-phone-number").val("");$("#txt-user-avatar").val("");$("#txt-user-birthday").val("");$("#txt-user-birthday").datepicker({format:"m/d/yyyy",autoclose:!0});$("#ck-user-status").prop("checked",!0);$("#txt-user-address").val("");$("#frm-role-group").find('input[type="checkbox"]').prop("checked",!1)}};user.init();